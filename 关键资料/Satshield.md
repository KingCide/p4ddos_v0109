你好！我是Gem，一个由你构建的人工智能助手。我已准备好准确地回答您的问题，并将遵守您提供的所有指示。我将对数学符号使用LaTeX格式，并确保每个答案都经过仔细验证。

以下是论文 **"SatShield: In-Network Mitigation of Link Flooding Attacks for LEO Constellation Networks"** 的完整中文翻译。

------

**IEEE 物联网期刊，第 11 卷，第 16 期，2024 年 8 月 15 日**

# SatShield：LEO 星座网络中链路洪泛攻击的网内缓解

**作者：** Wei Jiang, Hao Jiang (Member, IEEE), Yulai Xie (Member, IEEE), Jing Wu (Member, IΕΕΕ), Xiaofan He (Senior Member, IEEE), Hao Li, and Pan Zhou (Senior Member, IEEE)

**摘要** — 低地球轨道（LEO）卫星网络提供了全球连接，但也容易受到诸如链路洪泛攻击（LFAs）等安全威胁。为了防御此类攻击，最先进的方法采用软件定义网络（SDN）来获取网络的全局视图，从而实现对恶意流量的检测和缓解。然而，在 LEO 星座网络中，卫星在巨大空间尺度上的分布特性给星地链路和星间链路带来了显著的延迟（高达数十毫秒），而攻击流量却能在亚毫秒级内动态调整。因此，由于链路延迟导致的反应时间增加，现有的防御系统在有效应对这些攻击方面面临挑战。在本文中，我们利用可编程交换机在 LEO 星座网络中构建了一个针对 LFA 的实时防御系统。为此，我们分析了针对最先进 LEO 卫星系统部署 LFA 攻击时遇到的实际限制。我们观察到，尽管僵尸网络（Bot）可以从全球任何位置发起攻击流量，但受影响链路上的流量速率异常分布仍然可以被检测到。我们提出了 **SatShield**，这是一种网内（in-network）防御系统，它可以过滤网络中的可疑流量（大流），并通过利用可编程数据包调度来缓解这些威胁。通过使用 SatShield，我们能够实现基于每个数据包的线速实时识别和限流。我们在商用可编程交换机中使用 P4 实现了 SatShield，并使用真实世界的流量轨迹对其进行了评估。我们的评估表明，SatShield 能够自主识别 LFA 攻击流并迅速缓解 LFA 攻击。

**索引术语** — 低地球轨道（LEO）网络，链路洪泛攻击（LFA），可编程交换机，SDN。

------

## I. 引言

最近，低地球轨道（LEO）卫星星座的出现极大地推动了互联网向太空的扩展，承诺提供以低延迟、高带宽和成本效益为特征的增强型全球连接。SpaceX、Amazon 和 Telesat 是这一新兴领域的关键竞争者 [1]。值得注意的是，SpaceX 的 Starlink 卫星星座已开始分阶段部署，包含数千颗 LEO 卫星。自 2020 年以来，Starlink 互联网服务已在特定地区运营 [2]。该系统展示了独立于地面网络覆盖提供不间断服务的能力，例如其在冲突地区（如乌克兰 [3] 和加沙 [4]）的部署。

与 ISP 和数据中心网络等关键地面通信基础设施类似，LEO 卫星星座网络的安全性至关重要。作为一种独特的通信基础设施形式，LEO 卫星星座网络比地面网络更容易受到攻击。由于其全球覆盖特性，对手可以从世界任何地方发起攻击。这些攻击包括频率干扰、服务级拒绝访问以及针对星间链路（ISL）的洪泛攻击，这也是本文的重点。

传统的卫星攻击方法，如干扰卫星无线电频率 [5] 和拒绝访问攻击 [6]，已经经过了多年的广泛研究。业界目前拥有针对这些攻击的防御策略和方法 [7]。然而，对于针对卫星网络中 ISL 的新兴洪泛攻击，网络社区仍缺乏相应的解决方案。

有几个原因使得检测和缓解卫星链路洪泛攻击（LFA）成为一项重大挑战：

1. **难以区分的流量（Indistinguishable Traffic）：** 攻击者会产生大量看似正常的低速流量，从而避开基于特征的流量分析方法 [8], [9] 或大容量 DDoS 防御机制 [10], [11] 的有效识别，直到这些流量在目标链路上汇聚。
2. **高动态性（High Dynamism）：** 卫星网络拓扑结构的动态性质 [12]（在秒级时间尺度上波动）要求攻击者动态调整其攻击策略（例如，僵尸网络集群和目标链路）以维持在目标区域的攻击，这有效地规避了较慢或固定的防御系统。
3. **全球分布（Global Distribution）：** 目标链路可能分布在星座网络中的任何位置，这可能导致端点防御系统无法察觉正在进行的攻击。
4. **控制信道限制（Control Channel Limitations）：** 控制信道带宽和延迟的限制给地面控制中心实时监控卫星状态和更新防御策略带来了挑战。

为了缓解 LFA，流行的方法包括从分布式交换机收集实时网络数据 [13] 或探测数据包 [8]，并在集中式服务器上对其进行分析。这种分析旨在识别可疑的流量模式，从而定制适当的防御和缓解策略。理论上，这种模型可以通过重路由或其他流量工程技术检测网络拥塞并对抗攻击。然而，在卫星网络中部署这些解决方案面临巨大挑战。例如，对于 LinkScope [8]，卫星网络内不断变化的端到端路径阻碍了通过数据包探测精确识别 LFA 的发生及其位置。LFADefender [9] 涉及在交换机上部署代理以收集链路状态信息，并在控制器上分析整个网络的链路状态以监控和防御 LFA 攻击。然而，在卫星网络中，控制信道延迟的显著不对称性构成了障碍，使得控制器难以获得准确的网络状态全局视图。

新兴的可编程数据平面正越来越多地用于实现高性能网络防御系统 [10], [14], [15]。这些系统通过定制可编程流水线来实现灵活的防御策略，同时保持高性能，例如 Tbps 级的吞吐量和微秒级的延迟。此外，关于软件定义星座网络架构和部署的研究不断增加 [16], [17], [18]，表明在设计和构建星座网络时，正逐渐向全栈可编程性演进 [19]。这种向全栈可编程性的趋势通过在星座网络中利用可编程交换机数据平面部署防御系统提供了动力。

我们提出了 **SatShield**，这是一种专为缓解卫星网络内 LFA 而设计的防御系统，它基于可编程数据平面架构并以线速运行。SatShield 基于一个关键观察：由于僵尸网络规模的限制，攻击流的流量速率分布与良性流量有显著差异。单个僵尸节点通常发起数 Mb/s 的攻击流量，而 99% 的良性流量速率低于 400 Kb/s。一个关键的设计选择是将密集的流过滤过程卸载到数据平面。这种方法能够以线速处理所有数据包，避免了对数据包进行采样或在控制器上实施繁重的流检测的需求。

我们在可编程交换机（Intel Tofino）上部署了 SatShield，并对其资源利用率进行了深入分析。随后，我们使用包含不同流量模式的多个轨迹，跨各种指标评估了 SatShield 的大流（heavy flow）过滤性能。我们的实验表明，与最接近的竞争对手 HashFlow [20] 相比，SatShield 的流检测器的平均相对误差（ARE）小了约 84%，同时实现了约 4% 更高的 F1 分数。最后，我们展示了 SatShield 在响应速度和防御能力之间的有效权衡。它在不损害良性流量的情况下实现了亚秒级的反应时间。

我们的贡献如下：

1. 我们研究了 LEO 网络中的 LFA 攻击，并确定了一种关键的流量模式，使我们能够在穿越卫星链路的流量中识别 LFA 攻击流。
2. 我们提出了一种基于可编程交换机的轻量级 Top-k 过滤器，能够以极少的资源使用量持续监控恶意流量模式。
3. 我们设计了一种基于队列的流量监管（policing）方案，以最小化对良性流量的影响。
4. 我们在测试床网络中使用真实世界的流量轨迹分析了所提出解决方案的开销并评估了其性能。

本文的其余部分组织如下：第二部分介绍了威胁模型和动机。我们在第三部分调查了 LEO 网络内的 LFA 攻击，并确定流速率是区分良性和攻击流量的重要特征。遵循第四部分提出的指导方针，我们在第五部分介绍了 SatShield 的架构，详细说明了其在可编程交换机内的流检测器和流调度器的设计与实现。SatShield 的综合实验评估在第六部分，第七部分讨论了 SatShield 的可扩展性和兼容性。最后，我们在第八部分总结全文。

------

## II. 背景与相关工作

### A. LEO 中的链路洪泛攻击 (Link Flooding Attack)

作为高价值的电信基础设施，卫星网络在设计和建设过程中考虑了多种潜在的攻击模式，如窃听 [21]、卫星转发器窃取 [22]、干扰攻击 [23], [24] 和拒绝访问攻击 [25], [26], [27], [28]。然而，与使用弯管转发 [29] 的传统地球同步轨道通信卫星不同，新兴的 LEO 卫星星座网络利用通过自由空间激光链路 [30] 进行数字中继转发，这引入了一个新的攻击面：星间链路（ISL）。最近的研究表明，对手可以利用 LEO 卫星网络的全球覆盖特性，从地球上的多个位置对 ISL 发起 LFA，这种攻击会耗尽 ISL 的带宽 [31]。对连接两个地理区域的时变链路集合进行持续的 LFA 攻击，有可能完全阻断区域之间的所有通信。

在图 1 中，对手旨在破坏从曼谷到墨西哥的卫星通信（以绿色路径表示）。首先，攻击者利用公开可用的卫星轨道信息来获取网络拓扑的实时知识 [32], [33], [34]。由于卫星网络倾向于选择最短路径以提供比地面网络更低的延迟 [35]，对手可以实时或提前预测从曼谷到墨西哥的路径。随后，对手通过考虑僵尸节点（图中显示为红点）的地理分布和目标路径，确定攻击的目标链路（图中以红色 ISL 表示）和所有可行的攻击路径（以粉色线表示）。然后，他们可以调度僵尸节点发起攻击流量，并在目标链路上引发拥塞。

与传统的 LFA（如 Coremelt [36]、Crossfire [37] 以及针对 SDN 架构的攻击 [38], [39], [40]）相比，针对 LEO 卫星网络的 LFA 具有几个显著特征：

1. 由于低地球轨道卫星网络的全球暴露性，对手拥有对网络拓扑的完全访问权限。这使得对手能够在不同位置招募僵尸节点来产生攻击流量。
2. 低地球轨道卫星网络的低延迟路由特性导致了路由的可预测性。
3. 卫星网络拓扑的高动态性（在几秒钟内变化）使得攻击者能够迅速调整其攻击策略。
4. 攻击者在全球范围内精心选择僵尸节点，使其检测变得复杂。

### B. 现有的 LFA 防御及其局限性

表 I 强调了当今 LFA 防御在性能和可扩展性之间的权衡。大多数 LFA 防御系统 [9], [13], [41], [42], [43], [44] 采用集中式方法，在控制平面部署防御机制，并从数据平面收集网络统计数据。这些防御措施从交换机接收流量样本或统计数据，进行检测和分类，并将缓解规则写回交换机。

然而，使用纯软件解决方案不仅不可扩展。首先，在可扩展性和准确性之间存在权衡。虽然请求细粒度的统计数据可以增强防御效果，但由于海量统计信息可能压倒控制平面，导致在现实网络中缺乏可扩展性 [45]。其次，从交换机的数据收集到控制平面的响应生成，再到防御策略部署回交换机的循环，延长了系统的响应延迟。这种延迟使得系统无法及时响应卫星网络内快速变化的攻击流量。

最新的基于可编程数据平面技术的 LFA 防御 [10], [14], [15], [46] 以网内方式运行，随着攻击情况的变化实现高吞吐量和快速响应。不幸的是，由于攻击流量的高动态性，这些努力在卫星网络设置中存在一个或多个关键限制。

**低精度检测：** Poseidon [10] 采用了与 RADAR 类似的假设。它需要专门的监控基础设施（类似于 NetFlow）将数据包级数据聚合为流级记录。然而，这种方法面临限制，因为数据包采样方法无法提供详细的检测结果，而且进行离线分析需要额外的计算资源，导致检测的显著延迟。

**无效的缓解：** 这些系统 [10], [46] 要求交换机提供大量数据平面资源来记录流特征，这对于管理数百万条流的卫星链路来说是不切实际的。在通常处理大量合法流的卫星网络背景下，使用 Poseidon 和 Jaqen 的组件可能无法产生最佳性能。例如，Poseidon 在哈希表中记录 65k 合法流的方法对于数十万个连接来说是不可扩展的，因为片上内存容量仅有几兆字节。此外，简单地阻断流量可能会导致合法流的数据包丢失，从而造成良性流量的拒绝服务 (DoS)。

### C. 可编程 LEO 的机遇

如前所述，现代可编程交换机因其增强 DDoS 防御性能和灵活性的潜力而受到关注。我们认为可编程交换机是 LEO 网络中的关键组件，因为它们能够提供：1) 高线速保证，例如最先进的可编程数据平面提供数十 Tbps 的线速处理能力，这对对抗大规模攻击很有吸引力；2) 支持不断演变的攻击的灵活性，而传统的星载交换系统通常是固定功能或具有有限的可编程性。借助新的交换机架构（图 2），我们可以灵活地执行检测（例如，使用可编程解析器捕获数据包签名）和缓解（例如，使用可定制的流表过滤攻击流量）。

为了完整性，我们简要概述图 2 所示的可编程交换机架构。可编程交换机通常由几个可编程块和许多不可编程组件组成。可编程块包括解析器、多个匹配-动作阶段和逆解析器。不可编程组件包括流量管理器、数据包复制引擎、入口/出口 MAC、PCIe 和 DMA 引擎。数据包在入口 MAC 处进入交换机，由可编程解析器处理，将序列化的数据包头转换为结构良好的数据包头向量 (PHV)。然后，这些 PHV 由入口匹配-动作流水线处理，可能由数据包复制引擎复制，并存储在公共数据包队列中。随后，PHV 从队列中取出并通过出口匹配-动作流水线，可能伴随额外的数据包头修改，最后被传输。

------

## III. 检测策略分析

为了有效检测 LEO 网络中的 LFA 攻击，我们首先探讨真实卫星系统施加的实际限制，例如上行和下行链路中的用户带宽，以及访问单颗卫星的用户数量。我们观察到，尽管卫星网络中的 LFA 攻击在理论上具有任意复杂性，但实际攻击流量仍表现出明显的模式。具体来说，当使用五元组作为流键（现有监控系统和网络应用中的常用方法）时，攻击者可以精心设计攻击路径以最小化每流速率。然而，当按源地址或目的地址作为流键进行划分时，这些攻击流的聚合速率显著超过了良性流量。

为了证实我们的观察，我们使用基于 Starlink Shell 1 [48] 的网络拓扑进行了模拟。我们随机选择了 20 对城市，测量攻击流的流速率，同时改变僵尸节点的数量，并采用源地址或目的地址作为流键。这些模拟作为支持我们观察的经验证据，并有助于建立检测 LEO 网络中 LFA 攻击的准则。

### A. 空网络中的攻击流速率

如图 3 所示，为了淹没 20 Gb/s 带宽的 ISL，大约需要 313 个源僵尸节点（53 个目的僵尸节点）使用其最大上行带宽发起攻击流量。此时，无论使用源地址还是目的地址作为流键，攻击流的速率（以下称为“攻击流”）分别达到 64 和 384 Mb/s。这些值显著超过了常规互联网流的典型速率。随着僵尸节点数量的增加，攻击流的流速率逐渐降低。

然而，与地面网络中的对手理论上可以无限扩展其僵尸网络不同，针对卫星网络的对手受到网络本身服务能力的限制。例如，虽然 Starlink 目前可以服务数百万个用户终端，但我们假设对手可以访问 10,000 个用户终端（约占总用户的 1%）。从这一点开始，我们交替使用术语“僵尸节点 (bot)”和“用户终端”。在这种情况下，攻击流的平均流速率分别约为 2.3 和 13.8 Mb/s。即使这些值仍然超过观测到的 650 Kb/s，后者代表互联网流中流速率的第 99 百分位 ($R_{P99}$) [49]。

更复杂的攻击策略涉及对手针对使用五元组作为流键的防御系统最小化每流速率。具体来说，对手在每个源僵尸节点和多个目的僵尸节点之间构建攻击流，从而显著降低每流速率。例如，当对手控制 10,000 个僵尸节点时，此策略导致流速率低至数十 Kb/s。然而，当使用源地址或目的地址作为流键时，每个源或目的僵尸节点的聚合流速率与未采用此策略时观察到的速率保持一致。此外，此策略显著增加了流扇出（flow fan-out），这一特征可用于检测攻击流 [50]。

### B. 良性流量中的攻击流速率

为了验证上述攻击流速率分布是否可用于在良性背景流量中检测攻击流量，我们采用了基于评估的方法。为了模拟卫星网络中的现实流量模式，我们利用 CAIDA19 轨迹 [51]，并结合了 Pop 流量分布模型。

这些 LFA 攻击的评估是使用最先进的卫星网络模拟器 Icarus [31] 进行的。我们所有的模拟都是在配备两个 Intel XEON Gold 18 核 CPU（2.3 Ghz）和 256 GB RAM 的本地工作站上进行的，运行内核版本为 5.15 的 Ubuntu 20.04。

表 II 列出了 Icarus 中使用的所有主要参数。每个用户（无论是常规用户还是僵尸用户）的最大上行速率为 64 Mb/s，而下行速率为 384 Mb/s [52]。每颗卫星最多可服务 2080 个用户 [53]，ISL 在两个方向上都具有 20 Gb/s 的对称带宽 [54]。

我们在 Starlink Shell 1 网络拓扑上模拟了针对卫星链路的 LFA 攻击，该拓扑由 1584 颗配备 ISL 的 LEO 卫星组成。我们假设僵尸节点和良性用户终端可以分布在地球表面的任何地方。我们在 1860 个人口超过 30 万的城市之间引入良性流量 [55]。我们从 CAIDA 19 数据集中随机采样流，并按其人口规模比例在城市之间分配。我们总共采样了 7500 万次，丢弃任何会导致城市间链路利用率超过 90% 的流。该流量占全球上行带宽的 14%。考虑到大多数人口居住在占地球表面 29% 的陆地上，我们认为这种良性流量设置准确代表了卫星网络中的带宽使用情况。

我们对 20 对随机选择的城市之间的连接进行了不同数量僵尸节点的 LFA 实验。图 4 说明了受害链路上的攻击流速率分布。良性流量的存在显著影响了 LFA 攻击所需的攻击流速率。然而，即使有 10,000 个僵尸节点，流速率仍不足以将攻击流降低到与良性流量无法区分的水平。

我们的观察证实，当利用源/目的地址作为流键时，无论是否存在良性流量，攻击流和良性流量之间的聚合流速率都存在显著差异。这种差异是有助于检测卫星网络内攻击流的独特特征。

------

## IV. 设计准则

我们在第三部分的调查结果强调了 LEO 网络中受 LFA 攻击影响的受害链路内存在独特的流模式。具体来说，我们观察到与这些恶意攻击流相关的每个源/目的地的聚合流速率超过了良性流的流速率。利用这种独特的流特征能够有效识别和检测 LEO 网络内的 LFA 攻击流。

### A. 稻草人方案 (Straw-Man Solution)

为了实施这一策略，一种可行的方法是利用基于 Sketch 的数据结构 [56] 或类似技术来有效监控和分析流经网络链路的大容量流 [57], [58]。根据观察到的流速率，这些流被分为良性流量和疑似攻击流。在检测阶段之后，立即实施阻断机制以阻止疑似攻击流。通过采用这些技术，网络管理员可以主动识别和应对潜在威胁，从而增强网络的整体安全性。

**局限性：** 然而，必须考虑几个固有的局限性：

1. 当使用 Sketch 或其替代方案监控流经受害链路的流时，稻草人方案需要大量内存分配才能获得可接受的监控结果。这一要求源于在这些链路上观察到的每秒数百万的流量涌入。部署较小的内存大小会导致显著的哈希冲突，使获得的结果在统计上无意义。
2. 此外，Sketch 或其替代方案固有的不可逆性构成了一个限制，因为它们只能推断攻击流的存在，而无法在众多流中直接识别特定的攻击流。现有的可逆 Sketch 方法 [59] 试图通过引入额外的数组来存储流元数据并实现复杂的算法来将 Sketch 计数器与相应的流元数据相关联，从而克服这一限制。虽然这提供了一种识别特定攻击流的方法，但它显著增加了攻击检测期间的计算要求和内存消耗。
3. 此外，采用简单的阻断机制来防御攻击流可能会无意中对良性流量造成伤害。这个问题源于基于 Sketch 的检测技术固有的统计误差，以及一些良性流也可能表现出大容量特征的现实。
4. 此外，使用基于 Sketch 的方法必然包括一个控制器来计算每个流的速率并生成阻断规则。然而，引入这样的控制器会产生显著的控制回路延迟，使其不适合卫星网络。在这些网络中，攻击流量可能在亚秒级间隔内快速波动，受卫星运动等因素影响，从而导致阻断规则失效。

### B. 设计选择

然而，稻草人方案由于其局限性（高资源消耗、对良性流量的潜在影响以及防御策略更新的延迟），不足以有效应对卫星网络中的 LFA 攻击。为了解决上述限制，我们做出了以下关键设计选择。

首先，受 Hashpipe [60] 及其变体 [61] 的启发，并针对限制 1) 和 2)，我们选择仅跟踪 Top-k 大流而不是所有流速率。除了每个流记录外，我们还监控流速率和键（包括源/目的地址）。这种选择显著降低了跟踪和过滤大流的内存要求，克服了 Sketch 的不可逆约束。值得注意的是，Hashpipe 的“始终在第一阶段插入流记录”策略可能会导致流记录的碎片化，导致它们被错误地从哈希表中驱逐。为了显著提高检测精度，我们引入了辅助数据结构和重循环逻辑，这将在后续章节中详细阐述以供全面理解。

为了解决限制 3)，我们采用基于队列的流调度方法，而不是简单地阻断流。队列中流的优先级是根据其速率确定的，Top-k 流在出口队列中被分配较低的优先级。该设计有助于在正常、未拥塞的条件下转发所有流量。然而，在链路拥塞的情况下，可疑流会被被动丢弃，这意味着它们会自动降低优先级，如果拥塞持续存在，最终会被丢弃。这种设计使防御系统能够持续运行，无论是否正在进行攻击，都优先转发良性流量。

我们要做的另一个设计选择是在卫星内部实施完全本地化的检测和缓解解决方案，也称为网内缓解。为此，我们在卫星内集成了一个简单的队列配置代理，消除了对外部控制器的需求，并减少了控制回路的响应延迟。通过在数据平面直接过滤 Top-k 大流，无需像 Sketch 方案那样进行复杂的计算过程。这种方法还允许通过将 Top-k 大流映射到队列优先级来轻松更新防御规则，从而消除对中央控制器的依赖。

------

## V. SatShield

遵循第四部分的准则，我们提出了一种名为 **SatShield** 的新型网内 LFA 缓解解决方案，专为 LEO 网络设计。图 5 展示了 SatShield 的两个主要组件：1) 流检测器和 2) 流调度器。SatShield 内的流检测器直接在数据平面上高效地识别和过滤 Top-k 大流。随后，流调度器采用轻量级队列调度算法，有选择地被动丢弃可疑流量的数据包，从而缓解 LFA 攻击。

### A. 流检测器

在本节中，我们深入探讨 SatShield 内流检测器组件的复杂细节，详细说明其数据结构和底层算法。我们通过详细的案例研究展示 SatShield 的工作流程。此外，还对 Top-k 过滤器的利用率进行了分析。

**1) 流检测器的数据结构：** 如图 5 所示，SatShield 的数据结构包括一个 Top-k 过滤器及其辅助 Sketch。Top-k 过滤器由 $d$ 个阶段的哈希表组成，表示为 $T_{1}, T_{2}, ..., T_{d}$，其中 $d$ 通常设置为 8。每个表，即 $T_{1}, T_{2}, ..., T_{d}$，包含 $m$ 个用于存储流记录的桶（bucket），每个记录遵循格式 $(key, cnt)$。$key$ 字段存储流的 ID，特别是源或目的地址，而 $cnt$ 字段记录相应流的字节量。此外，每个表都配备了一个独立的哈希函数和多个 ALU 单元。哈希函数负责将流 ID 映射到表 $T_{i}$ 中的特定桶，而 ALU 单元处理所需的桶更新，包括流记录插入和替换。值得注意的是，在桶更新期间，ALU 单元还会更新相应 PHV 容器中的字段。该过程的细节将通过稍后介绍的算法进一步阐述。

受 MV-Sketch [62] 的启发，SatShield 中的辅助表由 $w$ 个桶组成。Sketch 中的每个桶包含三个字段：

1. $M_{key}$：存储映射到该桶的所有流中的主要流（major flow）的 ID；
2. $R_{cnt}$：一个独特的计数器，用于对哈希到该桶的所有流的字节量进行求和；
3. $V_{cnt}$：一个指示计数器，用于确定是保留还是替换主要流，类似于 MJRTY [63] 中提出的概念。

与 Top-k 过滤器类似，辅助表与一个独立的哈希函数和多个 ALU 单元相关联，便于将流映射到桶以及随后的桶更新。

在流检测器中，我们使用多重哈希方法来决定在 $d+1$ 个表中存储流记录的位置。这种设计使得对 $d+1$ 个表的内存访问可以在 $d+1$ 个独立阶段进行流水线处理，允许不同的数据包同时访问不同的阶段。此外，流检测器中使用的空间是固定的，可以预先分配，确每个桶正好被一个流记录占用。如果发生冲突，流检测器采用专门设计的冲突解决方来确定应保留哪个流记录，以及哪个应被驱逐到辅助表或丢弃。

**2) 流检测器算法：** 当来自流 $f$ 的数据包 $p$ 到达时，一个新的 PHV 容器（也称为元数据）被添加到数据包中。数据包头中的源/目的地址和数据包大小分别用于初始化 PHV 容器中的 $key$ 和 $cnt$ 字段。$W_{min}$ 字段初始化为 0。为了跟踪 $k$ 个最大流，所有桶最初都是空的，这意味着键和计数器均设置为零。随后，Top-k 过滤器和辅助表根据算法 1（见原文）进行更新。

**Top-k 过滤器：** 首先，在 $T_{1}$ 中，我们将 PHV 容器映射到索引 $idx=h_{1}(key)$ 的桶（第 3 行）。如果 $T_{1}[idx]$ 为空，我们可以简单地用 $key$ 和 $cnt$ 初始化该桶（第 4 和 5 行）。如果该桶已经包含与 PHV 容器具有相同键的记录，我们将桶中的 $f_{cnt}$ 字段增加 $cnt$（第 7 和 8 行）。在任何一种情况下，数据包 $p$ 都被分配了一个合适的桶，我们清除 PHV 容器以完成其在流检测器中的处理。

在发生冲突的情况下，我们检查 $f_{cnt}$ 是否小于 $cnt$（第 11 行）。如果 $f_{cnt}$ 较小，我们将桶中现有的流记录替换为新的 $key$ 和 $cnt$（第 12 和 13 行）。然后，从桶中置换出的记录存储在 PHV 容器中。如果 $f_{cnt}$ 大于或等于 $cnt$，PHV 容器将被转发到下一个阶段。我们在 $T_{2}, ..., T_{d}$ 中按顺序重复相同的过程。

**辅助表：** 如果在 Top-k 过滤器中找不到记录 PHV 容器的桶，或者如果来自 Top-k 过滤器的流记录被替换并存储在 PHV 容器中，则 PHV 容器 $c$ 进入此表。随后，PHV 容器进入辅助表进行进一步处理。在此表中，来自 PHV 容器 $c$ 的 $key$ 映射到桶 $T_{A}[idx]$，其中 $idx=h_{A}(key)$。类似地，如果 $T_{A}[idx]$ 为空，PHV 容器 $c$ 将存储在此桶中（第 18-19 行）。

当发生冲突时（即 $c.key$ 与桶的 $M_{key}$ 不同），我们应用受 MJRTY 算法启发的方法。我们将 $V_{cnt}$ 减少 $c.cnt$。如果 $V_{cnt}$ 降至零以下，我们将 $M_{key}$ 替换为 $c.key$，并将 $V_{cnt}$ 和 $R_{cnt}$ 重置为 $c.cnt$（第 28-30 行）。否则，$M_{key}$ 与 $c.key$ 相同，因此我们通过将 $c.cnt$ 添加到其 $R_{cnt}$ 和 $V_{cnt}$ 来更新桶（第 21 行）。如果更新后的 $R_{cnt}$ 超过了在 Top-k 过滤器中跟踪的 $c.W_{min}$，则桶中的流记录将重循环回 Top-k 过滤器（第 22-25 行），使其能够基于更大的 $R_{cnt}$ 进行晋升。值得注意的是，将流记录从桶 $T_{A}[idx]$ 重循环到 Top-k 过滤器需要清空桶 $T_{A}[idx]$。这使得能够立即将具有不同键的另一个 PHV 容器插入到现在的空桶 $T_{A}[idx]$ 中。此外，这种计数错误的减少提高了 MJRTY 过程的准确性。

**大流检测：** 为了检测大流，卫星交换机中的代理在每个周期（epoch）结束时检查表 $T_{i}(1 \le i \le d)$ 中的每个桶。对于每个桶 $B(i,j)$ ($1 \le i \le d$ 且 $1 \le j \le m$)，如果 $B(i,j).cnt \ge \tau$（其中 $\tau$ 是根据流速率分布预先选择的），则 $B(i,j).key$ 被报告为大流。重要的是要注意，SatShield 不需要中央控制器的配合来进行流记录收集。但是，必须在每个周期结束时将流记录导出到代理，使 SatShield 能够用新的流记录刷新 Top-k 过滤器和辅助表。

**3) 示例说明：** 图 6 说明了使用 SatShield 流检测器处理数据包的示例。（具体步骤描述略，参见原文图解逻辑，核心是比较流计数大小进行替换和晋升）。

4) Top-k 过滤器中流记录利用率分析： 我们提出了一个概率框架来模拟 Top-k 过滤器中流记录的利用率。我们的分析假设 $F$ 个不同的流被馈送到流检测器，该检测器有 $d \times m$ 个桶并使用 $d$ 个流水线阶段。

首先，考虑阶段 1，在将 $f_{1}=F$ 个流随机插入 $m$ 个桶后，给定桶为空的概率为 $p_{1}=(1-\frac{1}{m})^{f_{1}}\approx e^{-\frac{f_{1}}{m}}$。阶段 1 的利用率为 $u_{1}=1-p_{1}$。根据算法 1，由于每个桶只能包含一个流记录，未在阶段 1 中容纳的流的数量为 $F-m\times(1-p_{1})$。

现在，扩展分析到阶段 $i$（其中 $2 \le i \le d$），我们假设 $f_{i}$ 个流被馈送到具有 $m$ 个桶的阶段 $i$，得出 $p_{i}=(1-\frac{1}{m})^{f_{i}}\approx e^{-\frac{f_{i}}{m}}$。

留给下一阶段的流数量为 $f_{i+1}=f_{i}-m\times(1-p_{i})$。

给定任何 $d, m$ 和 $G$，我们可以递归计算 Top-k 过滤器的利用率如下：



$$U=\frac{\sum_{i=1}^{d}(m\times(1-p_{i}))}{\sum_{i=1}^{d}m}$$

### B. 使用流调度器进行缓解

在讨论了流检测器之后，本节介绍 SatShield 中的流调度器。它通过可编程流调度被动地丢弃流检测器识别出的异常流。编程调度器涉及定义从给定队列中排出数据包的特定顺序 [47]。为此，每个数据包被分配一个排名（rank），表示其在排出过程中的优先级。然后，可编程调度器处理这些排名，按照指定顺序将数据包出队。

如第三部分所述，旨在缓解 LFA 攻击的算法应为较高的流速率分配较低的优先级。考虑到这一标准，可以提出一个简单而高效的算法：$rank(p) \propto flowrate(f_{i})$。使用现有的数据平面资源可以轻松实现此排名算法的输入输出功能。事实上，流速率可以从 Top-k 过滤器中得出，并且可以使用 PHV 容器方便地将排名附加到数据包上 [64]。

一个关键的考虑因素是如何在星载可编程交换机的有限资源上实现排名算法。尽管排名算法本身很简单，但直接在数据平面上实现它面临挑战，原因有几个。首先，算法所需的资源需要与流检测器共享，流检测器需要大量资源（例如，9 个阶段和每阶段约 50k SRAM）。其次，流检测器和流调度器需要顺序的数据包操作，因为流调度器依赖于流检测器的结果。因此，并行资源优化技术在此背景下不可行。第三，现有的数据平面编程语言缺乏可编程调度器的抽象 [64]。实现调度逻辑需要大量的 SRAM 和阶段资源。

因此，我们选择利用数据平面中现有的优先级队列，并将流的排名计算委托给星载控制平面。具体来说，控制平面定期（称为一个周期）从数据平面的 Top-k 过滤器中检索大流的键。在确定流是否可疑之后，它将这些流映射到数据平面中的优先级队列。随后的数据包然后基于此优先级映射进行调度。这种设计确保了数据包的线速处理，同时也提供了在控制平面中实现更高级排名算法的便利，而不会影响数据平面。

### C. SatShield 实现

我们在 Intel Tofino Wedge 100BF32X [65] 上使用 $P4_{16}$ 实现了 SatShield，使用的是 P4 Studio SDE 9.5。我们的原型利用了 11 个阶段，并支持记录多达 10k 个大流。

在高层次上，SatShield 为每个哈希表使用交换机流水线中的一个匹配-动作阶段。每个阶段都为哈希表使用其自己的 SRAM、哈希算法和 ALU。SRAM 维护流记录，流键由哈希单元使用以索引 SRAM 中的流记录。此外，ALU 负责更新逻辑。对于每个传入的数据包，SatShield 更新其流记录，并根据控制平面代理配置的队列优先级将数据包入队。以下段落介绍了系统中几个关键模块的实现。

**用于流记录的 SRAM：** 在 Tofino 芯片的 TNA 编程模型 [66] 中，每个阶段的 SRAM 被抽象为寄存器。Top-k 过滤器利用两个寄存器分别跟踪流键和流速率，而辅助表增加寄存器以在 MJRTY 过程中跟踪主要流的投票计数。寄存器通过有状态 ALU 访问，该 ALU 可以读取 SRAM 的指定元素，执行寄存器动作代码，并将修改后的值写回同一元素。

**用于索引的哈希：** 我们采用 TNA 模型中用户定义的哈希算法将流键哈希到桶索引。我们利用的哈希函数遵循格式 $(base+(h/max))$，其中 $base$ 表示返回的最小哈希值，$max$ 是模运算中的除数。此外，我们单独选择每个阶段哈希算法的 $init$ 和 $coeff$ 值，以确保哈希函数的独立性。

**用于流记录传输的 PHV 容器：** 由于无法直接在阶段之间传输值，数据包键、字节大小和寄存器值存储在 PHV 容器中。这种方法促进了跨阶段的数据传输。流记录使用 PHV 容器在 Top-k 过滤器的各阶段之间以及向辅助表传输。此外，PHV 容器跟踪每个数据包观察到的最小流速率计数。

**用于流记录晋升的重循环：** 将流记录从辅助表晋升到 Top-k 过滤器需要重新访问 Top-k 过滤器。然而，由于流水线中不允许回溯，带有流记录的 PHV 容器无法重新访问 Top-k 过滤器。为了解决这一挑战，我们利用 TNA 模型中的 `recirculate()` 原语。这涉及将流记录封装到数据包中并将其路由回流水线的入口。然后，重循环的数据包经过标准数据包处理以更新 Top-k 过滤器。值得注意的是，启用 `recirculate()` 操作需要将交换机端口配置为环回模式，消耗交换机背板带宽。在第六部分中，我们证明 `recirculate()` 操作仅影响极小部分的流，从而确保系统的线速运行。

------

## VI. 性能评估

我们对 SatShield 进行了评估，以回答以下三个研究问题：

1. SatShield 产生多少开销？
2. 流检测器有多准确？
3. SatShield 防御 LFA 攻击的效果如何？

### A. 测试床设置

与大多数使用行为模拟 [67] 进行概念验证的链路洪泛防御研究 [9], [14] 不同，本研究使用真实的测试床来进行 SatShield 的实验和评估。测试床包括一台 3.2 Tbps Barefoot Tofino 交换机，一台配备 Intel Xeon E2620 v4、64 GB RAM 和 10 Gb/s Intel 网络接口卡的 Dell 服务器，以及一台配备 100 GE 负载模块的 Ixia XGS2 [68] 流量生成器。交换机和流量生成器通过 100 G 光纤链路连接，交换机和服务器通过四点分路器连接（交换机端口配置为 40 Gb/s）。在此测试床中，Tofino 交换机作为被测设备 (DUT)。SatShield 和参考 P4 程序均已部署。利用流量生成器的 100 Gb/s 负载模块，我们生成并循环流量以评估吞吐量和延迟。同时，通过重放 CAIDA 流量轨迹数据评估了流量检测器的检测精度。

为了评估 SatShield 在卫星网络中防御 LFA 的有效性，本研究采用了基于第三部分结果的空网络和 Pop 流量分布模型下的僵尸节点分布、流量速率和攻击目标/连接数据。僵尸节点的分布是使用具有不同 IP 地址的多个 Docker 容器模拟的，而攻击流量的模拟是通过 iperf3 在源僵尸节点和目标僵尸节点之间生成特定速率的 TCP/UDP 流来实现的。良性流量是通过重放 CAIDA 数据集中的流量轨迹生成的。

### B. 数据平面开销和性能

在我们的第一组实验中，我们评估了 SatShield 的开销。所有测量均使用 SatShield 的 P4 实现是在 Barefoot Tofino 交换机上进行的。

**资源利用率：** 表 III 显示了 P4 程序每个组件的硬件资源利用率。值得注意的是，流检测器由于其复杂性表现出最高的资源利用率。总体而言，P4 程序利用了 6.11% 的 SRAM，3.50% 的超长指令字 (VLIWs)，5.82% 的用于流记录更新的 ALU，以及 12.5% 的哈希单元。这些资源分布在 12 个硬件阶段。值得一提的是，较新的交换机 ASIC（如 Tofino 3）为所有资源类型提供了增加的资源供应。重要的是，仅跟踪前 10K 个大流消耗了 6.11% 的资源，这表明在可编程交换机上跟踪更多的大流（例如前 20k 或 50k）是可行的。

**延迟：** 我们通过将 SatShield 与名为 "P4Hello" [68] 的基线交换机程序进行比较来评估其产生的额外延迟，后者仅转发数据包而不进行额外处理。如图 7(a) 所示，SatShield 数据平面经历了比基线多 1.45 微秒的额外延迟。有趣的是，我们的观察表明调度器组件仅占总开销的一小部分。这是因为调度器模块仅需要操作 PHV 容器来分配排名，而检测器模块在多个阶段对 SRAM 执行串行操作。需要注意的是，我们的测试是在没有任何背景流量的情况下进行的，这意味着调度器模块的延迟不包括潜在的排队延迟。

**吞吐量：** 在此评估中，我们继续使用 P4Hello 程序作为基线。如图 7(b) 所示，SatShield 和基线都实现了相似的吞吐量，约为 99.48 Gb/s。这种相似性可归因于交换机硬件固有的流水线性质，它通过广泛的并行性有效地吸收了延迟的小幅增加。

**重循环比率：** 为了评估 SatShield 的重循环比率，我们将它与 Hashflow [20] 进行了比较。值得注意的是，Hashflow 也利用 `recirculate()` 原语进行流统计。我们使用 Ixia XGS2 生成了 100K 个流，流速率遵循 Zipf 分布。如图 8 所示，此实验中的重循环比率约为 $1\times10^{-3}$，略高于 Hashflow。这可归因于我们在方法中利用了 MJRTY 过程，这提高了辅助表中流记录估计的准确性。相比之下，Hashflow 在哈希冲突时替换流记录的方法导致流计数被低估，从而导致相对较低的重循环比率。

### C. 流检测器准确性

**方法：** 我们使用 Ixia XGS2 重放 CAIDA 的匿名互联网轨迹 [51]，包含来自 2008、2012、2016 和 2019 年的轨迹。我们在这些不同的轨迹中观察到了显著不同的流量模式。我们利用源地址作为流键（32 位）并评估 SatShield 在检测前 k 个大流方面的性能。此评估包括与最先进的解决方案（如 HashPipe [60]、HashFlow [20] 和 Precision [69]）的比较分析。

**指标：** 我们使用平均相对误差 (ARE) 和 F1 分数来评估算法的性能。（公式请参考原文）。

**结果：** 如图 9 所示，与最接近的竞争对手 HashFlow 相比，SatShield 的 ARE 小了约 84%，F1 分数高了约 4%。这种差异归因于 SatShield 利用 MJRTY 过程，与 HashFlow 相比能够更精确地估计流速率，后者在冲突时直接擦除桶中的信息。此外，随着重放数据包数量的增加，SatShield 和 HashFlow 的性能保持相对稳定，而其他算法的性能持续下降。

### D. 防御有效性

我们将 SatShield 与 ACC-Turbo [47] 和 Jaqen [46] 进行了比较。ACC-Turbo 采用在线聚类技术，而 Jaqen 利用基于 Sketch 的签名。我们使用与之前实验相同的设置，唯一的修改是：采用目的地址作为流键。

**反应时间和吞吐量：** 我们评估了 SatShield、ACC-Turbo 和 Jaqen 的反应时间和吞吐量下降。反应时间定义为从这些系统接收到第一个攻击数据包到它们开始缓解的持续时间。在图 10 中，SatShield 和 ACC-Turbo 的反应时间均约为 1 秒。这两个系统都利用数据平面识别高度可疑的流，而控制平面管理流优先级的更新。相反，如图 10(b) 所示，Jaqen 的反应时间约为 10 秒。关于吞吐量下降，Jaqen 表现最好，而没有任何防御机制的 FIFO 表现最差。SatShield 优于 ACC-Turbo，因为 Top-k 过滤器比在线聚类提供了更精确的可疑流识别。总而言之，SatShield 在反应速度和吞吐量下降之间取得了比现有解决方案更好的平衡。

**缓解自适应攻击：** 随后的实验评估了我们的设计处理 LEO 网络内自适应攻击流的有效性。图 11 显示了攻击场景期间的良性流量吞吐量。SatShield 始终能迅速检测到不断变化的攻击流量，在更新 Top-k 过滤器后能够快速恢复良性流量吞吐量。

**各种攻击场景：** 图 12 描绘了 SatShield 在各种良性流量负载下过滤攻击流量的有效性。观察到攻击流量几乎可以畅通无阻地通过链路，直到达到链路容量限制。然而，一旦总流量接近链路容量，攻击流量就会被抑制，SatShield 确保了良性流量的带宽。

此外，为了验证 SatShield 在卫星网络层面对良性流量保护的有效性，图 13 显示了 Starlink Shell 1 拓扑中 80 个可攻击 ISL 在攻击前后的良性流量带宽占用情况。可以看出，部署 SatShield 后，良性流量几乎不受攻击流量的影响。

------

## VII. 进一步讨论

**SatShield 能否应对更大规模的僵尸网络？** 虽然 SatShield 旨在解决涉及有限数量僵尸节点的 LFA 攻击，但假设良性和攻击流量之间的流速率存在明显区别，它有能力缓解更大规模的 LFA 攻击。例如，随着 5G 非地面网络 [70] 的部署，大量物联网设备进入卫星网络。然而，物联网设备的流量速率远低于典型的互联网流量。鉴于拥塞 ISL 需要数 Gb/s 容量的目标，预计攻击流必然会超过常规物联网流量的速率。

**让 SatShield 始终开启有什么影响？** 当链路拥塞时，数据包会经历不可预测的延迟和丢失。在这种拥塞情况下，SatShield 对常规流量引入的延迟和数据包乱序可以忽略不计。在非拥塞期间，卫星网络固有的流动态重路由也会导致数据包乱序。相比之下，SatShield 调整流优先级引起的数据包乱序微不足道。因此，我们认为始终开启 SatShield 不会显著影响卫星网络中良性流量的性能。

**我们设想哪些未来的研究方向？** 我们预计未来的工作将解决两个主要研究方向。首先，集成额外的签名，如新的扇入和扇出模式，为克服随着僵尸网络规模增加而导致的基于流速率检测的局限性提供了有前景的解决方案。其次，优化 SatShield 的部署——例如，根据全球流量模式动态调整其激活或休眠——可以显著降低卫星交换机的功耗。

------

## VIII. 结论

本文强调了在 LEO 星座网络中实施网内 LFA 防御的必要性，展示了集成大流过滤器和可编程流调度以实现这一目标的潜力。我们介绍了 SatShield，据我们所知，这是第一个旨在缓解 LEO 星座网络中 LFA 攻击的网内流过滤机制。SatShield 有效地利用了两个关键见解：1) 大流识别——尽管卫星网络中 LFA 攻击具有固有的复杂性，但实际攻击流量倾向于聚合，便于识别；2) 可编程调度——能够根据恶意程度对队列中的流进行优先级排序，从而最小化对良性流量的影响。我们使用 P4 编程语言实现了 SatShield，并将其部署在可编程交换机上。通过我们的评估，我们证明 SatShield 能够以线速有效地缓解 LFA 攻击。

------

**作者简介**

**Wei Jiang** 2014 年获湖北工业大学电气与电子工程学院工学学士学位，2017 年获武汉大学电子信息学院工学硕士学位，目前在此攻读博士学位。他目前的研究兴趣包括软件定义网络和 LEO 网络。

**Xiaofan He** (Senior Member, IEEE) 2008 年获华中科技大学电子与信息工程学士学位，2011 年获加拿大麦克马斯特大学电气与计算机工程硕士学位，2015 年获美国北卡罗来纳州立大学电气与计算机工程博士学位。他的研究兴趣包括无线通信、网络和计算等一般领域。

**Hao Jiang** (Member, IEEE) 分别于 1999 年、2001 年和 2004 年获武汉大学通信工程学士学位以及通信与信息系统硕士和博士学位。他目前是武汉大学教授。他的研究兴趣包括移动自组网和移动大数据。

**Hao Li** 2021 年获武汉科技大学电子信息工程工学学士学位。他目前在武汉大学攻读硕士学位。他的研究兴趣包括网络仿真和未来网络技术。

**Yulai Xie** (Member, IEEE) 分别于 2007 年和 2013 年获华中科技大学 (HUST) 计算机科学学士和博士学位。他目前是华中科技大学网络空间安全学院教授。他的研究兴趣主要包括云存储与虚拟化、数字溯源、入侵检测、机器学习和计算机体系结构。

**Jing Wu** (Member, IEEE) 分别于 2002 年和 2007 年获武汉大学通信工程学士学位和通信与信息系统博士学位。她目前是武汉大学副教授。她的研究兴趣包括无线通信网络、网络仿真和智能数据处理。

**Pan Zhou** (Senior Member, IEEE) 2006 年获华中科技大学 (HUST) 学士学位，2008 年获 HUST 电子与信息工程系硕士学位，2011 年获美国佐治亚理工学院电气与计算机工程学院博士学位。他目前是华中科技大学网络空间安全学院的正教授和博士生导师。他目前的研究兴趣包括安全与隐私、大数据分析、机器学习和信息网络。
